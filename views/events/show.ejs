<!DOCTYPE html>
<html lang="en">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="/css/show.css">
    </head>
    <body>
    <%- include('../partials/navBar.ejs')%>
    <h1>This is the events show page</h1>
    <div>
         <h3><%=event.title%></h3>
         Organized by: <a href="/user/<%=event.owner._id%>/"><small><%=event.owner.name%></small></a>
    <ul>
        <li>Location: <%=event.location%></li>
        <li>Date: <%=event.date.toDateString()%></li>
        <li>description: <%=event.description%></li>
        <li>Where to find us: <%=event.findUs%></li>
    </ul>
    </div>
    <div>
    
    <%let sum = 0%>
    <% for (let i = 0; i < event.participants.length; i++) {%>
        <% sum += 1%>
        <%}%>
    <h3>Event Participants (<%=sum%>)</h3>
    <ul>
    <% for (let i = 0; i < event.participants.length; i++) {%>
    <li><a href="/user/<%=event.participants[i]._id%>"><%=event.participants[i].name%></li></a>
    <%}%>
    </ul>  
    </div>  

   <h3>Are you going?</h3>
   <h4><%= session.joinMessage %></h4>
   <%if (user._id.toString() === sessionId) {%>
        <% if (!isAttending) {%>
            <div>
                <form action="/events/<%=event._id%>" method="POST">
                <button type="submit" class="yes-btn">Yes</button>
                </form>
            </div>
    <%}%>
   <%}%> 

   <% for (let i = 0; i < event.participants.length; i++) {%>
    <%if (event.participants[i]._id.toString() === sessionId) {%>
        <form action="/events/leave/<%=event._id%>" method="POST">
            <button type="submit" class="cancel-btn">Cancel Participation</button>
        </form>
    <%}%>
    <%}%>


   <%if (event.owner._id.toString() === sessionId) {%>
   <div>
   <h3>Event Owner Options</h3>
        <form action="/events/<%=event._id%>?_method=DELETE" method="POST">
            <button type="submit" class="yes-btn">Delete Event</button>
        </form>
        
        <div>
            <a href="/events/<%=event._id%>/edit">Edit Event</a>
        </div>

    </div>  
    <%}%>

    <section id="map"></section>

    <script> 

   
    function initMap() {
          // The location of Uluru
  var uluru = {lat: <%=latNum%>, lng: <%=lngNum%>};
  // The map, centered at Uluru
  var map = new google.maps.Map(
      document.getElementById('map'), {zoom: 13, center: uluru});
  // The marker, positioned at Uluru
  var marker = new google.maps.Marker({position: uluru, map: map});

    // Constructor creates a new map - only center and zoom are required.
    // const map = new google.maps.Map(document.getElementById('map'), {
    // center: {lat: <%=latNum%>, lng:<%=lngNum%>},
    // zoom: 13 });    
    
    // const place = {lat: <%=latNum%>, lng:<%=lngNum%>}
    // console.log(place)
    // const marker = new google.maps.Marker({
    //     postion: place,
    //     map: map,
    // })
    }

    </script>
    
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD3TNv_MLt6FZLTPzFGm0WCeE-EL2x2yGw&v=3&callback=initMap">
    </script>
    </body>
</html>